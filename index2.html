<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Victorian Traffic Behaviour and Accessibility</title>

    <!-- Vega and Vega-Lite libraries -->
    <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Afacad+Flux:wght@100..1000&display=swap" rel="stylesheet"> 

    <style>
        body {
            background-color: #c5e6f0;
            font-family: 'Afacad Flux', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .description-full {
            width: 100%;
            max-width: 1200px;
            padding: 20px;
            font-size: 1.1rem;
            margin-bottom: 20px;
            border: 1px solid #ddd;
            border-radius: 15px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            background-color: white;
        }
        .full-width-row {
            width: 100%;
            max-width: 1200px;
            margin-bottom: 20px;
        }
        .map-container {
            height: 700px; 
            border: 1px solid #ddd;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            padding: 10px;
            background-color: white;
            border-radius: 15px;
            overflow: hidden;
        }
        .map-description-full {
            width: 100%;
            max-width: 1200px;
            padding: 20px;
            font-size: 1.1rem;
            margin-bottom: 20px;
            border: 1px solid #ddd;
            border-radius: 15px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            background-color: #e0ded7;
        }
        .row {
            display: flex;
            width: 100%;
            max-width: 1200px;
            margin-bottom: 20px;
            align-items: center;
        }
        .visualization {
            flex: 2; 
            min-width: 78%;
            height: 500px;
            border: 1px solid #ddd;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            padding: 10px;
            border-radius: 15px;
            overflow: hidden;
            background-color: white;
        }
        .description {
            flex: 1; 
            min-width: 22%;
            padding: 20px;
            font-size: 1.1rem;
            
        }
        .divider {
            border: none;
            height: 2px;              
            background-color: #ddd;   
            margin: 20px 0;           
            }

        .metadata {
            width: 100%;
            max-width: 1200px;
            padding: 20px;
            font-size: 1.1rem;
            margin-bottom: 20px;
            border: 1px solid #ddd;
            border-radius: 15px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            background-color: #217342;
        }
        
        .row:nth-child(odd) .visualization {
            order: 1;
        }
        .row:nth-child(odd) .description {
            order: 2;
        }
        .row:nth-child(even) .visualization {
            order: 2;
        }
        .row:nth-child(even) .description {
            order: 1;
        }
    </style>
</head>
<body>

    <h1>Victorian Traffic Behaviour and Accessibility</h1>
    <div class = "description-full">
        <p> This is a dashboard that describes and visualises important Victorian traffic and road travel information
            This includes a choropleth map of all rest stops in Victoria, including what services are offered. There are also plots
            pertaining to annual traffic volume of vehicles per local government area (LGA), and also the direction of traffic flow.
        (Map below takes a few seconds to load, and the zoom slider is also a bit slow to respond). </p>
    </div>

    <!-- First Row (Full Width Map) -->
    <div class="full-width-row">
        <div id="map" class="map-container"></div>
    </div>

    <!-- Description for the Map -->
    <div class="map-description-full">
        <p> This map displays all rest area locations in Victoria.
            When hovering on a point, the rest area's municipality, locality, road name, type
            (e.g. what vehicles are accepted and which services are offered), amenity description and road speed limit.
            Travellers can easily choose where to stop depending on their needs and preferences.
        </p>
    </div>

    <hr class="divider">

    <!-- Second Row -->
    <div class="row">
        <div id="vis1" class="visualization"></div>
        <div class="description">
            <p>We can see that on average, Hobson's Bay has the highest annual daily traffic volume (27,733 vehicles),
                while South Gippsland has the lowest (5,522 vehicles).

            </p>
        </div>
    </div>

    <!-- Third Row -->
    <div class="row">
        <div class="description">
            <p> This stacked bar chart portrays the average daily traffic volume for local government areas, depending on the cardinal direction of travel.
                It is filtered it out for volumes > 5,000. 
            
            We can see that areas such as Hobson's Bay have many roads that go West, South West, North and East, while other areas such as Yarra, are more exlcusive to one direction - North West, for example.</p>
        </div>
        <div id="vis2" class="visualization"></div>
    </div>

    <!-- Fourth Row -->
    <div class="row">
        <div id="vis3" class="visualization"></div>
        <div class="description">
            <p>These are line plots that measure average trip time from 2012-2019, and relate to a respective trip purpose.
                It is seen that changing mode of transport undisputedly takes the most amount of time on average (low of 56.7 min in 2015, high of 64 min in 2017).
                On average, leaving the house to buy something takes the least amount of time, consistently remaining at around 15 minutes across the measured period. 
                This is likely attributed to the majority of trips intended for short stops at the local supermarket or pharmacy.
            </p>
        </div>
    </div>

    <div class = "metadata">
        <h2>Metadata</h2>
        <p>
            Name: Neil Tamhankar <br>
            Unit: FIT3179 <br>
            Date: 15/10/2024
        </p>
    </div>
    
    <script type="text/javascript">
        let centerX = 144.9631; 
        let centerY = -37.8136;

        // First Visualization (Map)
        const mapSpec = {
            "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
            "title": "Rest Area Locations in Victoria",
            "width": 1200,
            "height": 600,
            "params":[
                {
                    "name": "zoom_amount",
                    "value": 4000,
                    "bind": {
                        "input": "range",
                        "min": 3500,
                        "max": 30000,
                        "step": 1000,
                        "name": "Zoom: "
                    }
                },
                {
                    "name": "center",
                    "value": [144.9, -37.8],
                    "bind": {
                        "input": "select",
                        "options":[
                            [144.9, -37.8],
                            [144.27, -36.75],
                            [142.2, -36.76],
                            [147.75, -37.31]

                        ],
                        "labels": ["Melbourne CBD", "Bendigo", "Horsham", "Doctor's Flat"],
                        "name": "Centre of Map: "
                    }

                }
            ],
            "config": {
                "title": {
                    "font": "Afacad Flux",
                    "fontSize": 18
                },
                "axis": {
                    "labelFont": "Afacad Flux",
                    "titleFont": "Afacad Flux",
                    "labelFontSize": 12,
                    "titleFontSize": 14
                    },
                    "legend": {
                    "labelFont": "Afacad Flux",
                    "titleFont": "Afacad Flux",
                    "labelFontSize": 12,
                    "titleFontSize": 14
                    }
                
            },
            // "selection": {
            //     "brush": {
            //     "type": "interval"
            //     }
            // },
            // "params": [
            //     {
            //         "name": "zoom_level",
            //         "value": 30000,
            //         "bind": {
            //             "input": "range",
            //             "min": 3500,
            //             "max": 60000,
            //             "step": 100,
            //             "name": "Zoom: "
            //         }
            //     }
            // ],
            
            "projection": {
                "type": "mercator",
                "scale": {"expr": "zoom_amount"},
                "translate": [{"signal": "width / 2"}, {"signal": "height / 2"}], 
                "center": {"expr": "center"}
            },
            "layer": [
            {
                "data": {
                "url": "https://raw.githubusercontent.com/nt-p/FIT3179/main/Data/vic_suburb_borders_working.json",
                "format": {"type": "topojson", "feature": "vic_suburb_borders"}
                },
                "params": [{
                    "name": "grid",
                    "select": "interval",
                    "bind": "scales"
                }],
                "background": "grey",
                "mark": {
                    "type": "geoshape",
                    "stroke": "black",
                    "strokeWidth": 0.5,
                    "fill": "#b9e1ed"
                }
            },
            {
                "data": {
                "url": "https://raw.githubusercontent.com/nt-p/FIT3179/main/Data/Rest_Area.json",
                "format": {"type": "topojson", "feature": "Rest_Area"}
                },
                
                
                "mark": {
                "type": "circle",
                "color": "#245406",
                "opacity": 0.8,
                "size": 60
                },
                "encoding": {
                    "longitude": {"field": "geometry.coordinates[0]", "type": "quantitative"},
                    "latitude": {"field": "geometry.coordinates[1]", "type": "quantitative"},
                    "tooltip": [
                        {"field": "properties.MUNICIPALITY", "type": "nominal", "title": "Rest Area Municipality"},
                        {"field": "properties.LOCALITY", "type": "nominal", "title": "Rest Area Locality"},
                        {"field": "properties.ROADNAME", "type": "nominal", "title": "Rest Area Road Name"},
                        {"field": "properties.SITEAMENITY", "type": "nominal", "title": "Rest Area Amenity Desc."},
                        {"field": "properties.RESTAREATYPE", "type": "nominal", "title": "Rest Area Type"},
                        {"field": "properties.ROADSPEEDLIMIT", "type": "nominal", "title": "Road Speed Limit"},
                ]
                }
            }
            ]
        };
        vegaEmbed('#map', mapSpec).catch(console.error);

        // Second Visualization
        const spec2 = {
            "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
            "title": "Annual Traffic Volume per Local Government Area",
            "description": "A bar chart showing ALLVEHS_AADT by LGA_SHORT_NM.",
            "width": "container",
            "height": "container",
            "data": {
            "url": "https://raw.githubusercontent.com/nt-p/FIT3179/main/Data/Traffic_Volume.csv",
            "format": {"type": "csv"}
            },
            "transform": [{
                "filter": "(datum.ALLVEHS_AADT > 5000) && (datum.LGA_SHORT_NM != 'Missing Data')",

            }],
            "config": {
                "title": {
                    "font": "Afacad Flux",
                    "fontSize": 18
                },
                "axis": {
                    "labelFont": "Afacad Flux",
                    "titleFont": "Afacad Flux",
                    "labelFontSize": 12,
                    "titleFontSize": 14
                    },
                    "legend": {
                    "labelFont": "Afacad Flux",
                    "titleFont": "Afacad Flux",
                    "labelFontSize": 12,
                    "titleFontSize": 14
                    }
                
            },
            "selection": {
                "lga_highlight":{
                    "type": "single",
                    "fields": ["LGA_SHORT_NM"],
                }
            },
            "mark": "bar",
            "encoding": {
            "x": {
                "field": "LGA_SHORT_NM",
                "type": "nominal",
                "title": "Local Government Area",
                "sort": "-y"  
            },
            "y": {
                "aggregate": "average",
                "field": "ALLVEHS_AADT",
                "type": "quantitative",
                "title": "Average Daily Traffic Volume"
            },
            "color": {
                "field": "LGA_SHORT_NM",
                "type": "nominal",
                "legend": null,
                "scale": {"scheme": "category20c"}
            },
            "opacity": {
                "condition": {"selection": "lga_highlight", "value": 1},
                "value": 0.2
            },
            "tooltip": [
                {"field": "LGA_SHORT_NM", "type": "nominal", "title": "LGA"},
                {"aggregate": "average", "field": "ALLVEHS_AADT", "type": "quantitative", "title": "AADT"}
            ]
            }
        }
        vegaEmbed('#vis1', spec2).catch(console.error);

        // Third Visualization
        const spec3 = {
            "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
            "title": "Annual Traffic Volume by Flow Direction",
            "description": "A bar chart showing ALLVEHS_AADT by LGA_SHORT_NM.",
            "width": "container",
            "height": "container",
            "data": {
            "url": "https://raw.githubusercontent.com/nt-p/FIT3179/main/Data/Traffic_Volume.csv",
            "format": {"type": "csv"}
            },
            "params": [{
                "name": "grid",
                "select": "interval",
                "bind": "scales"
            }],
            "transform": [{
                "filter": "datum.ALLVEHS_AADT > 10000"
            }],
            "config": {
                "title": {
                    "font": "Afacad Flux",
                    "fontSize": 18
                },
                "axis": {
                    "labelFont": "Afacad Flux",
                    "titleFont": "Afacad Flux",
                    "labelFontSize": 12,
                    "titleFontSize": 14
                    },
                    "legend": {
                    "labelFont": "Afacad Flux",
                    "titleFont": "Afacad Flux",
                    "labelFontSize": 12,
                    "titleFontSize": 14
                    }
                
            },
            "selection": {
                "lga_highlight":{
                    "type": "multi",
                    "fields": ["LGA_SHORT_NM"],
                    "bind": "legend"
                }
            },
            "mark": "bar",
            "encoding": {
            "y": {
                "field": "FLOW",
                "type": "nominal",
                "title": "Flow Direction",
                "sort": "-y"  
            },
            "x": {
                "aggregate": "average",
                "field": "ALLVEHS_AADT",
                "type": "quantitative",
                "title": "Average Annual Daily Traffic (ALLVEHS_AADT)"
            },
            "color": {
                "field": "LGA_SHORT_NM",
                "type": "nominal",
                "legend": {
                    "title": "Local Government Area",
                    "columns": 2,
                    "labelLimit": 500,       
                    "symbolLimit": 50  
                },
                "scale": {"scheme": "category20c"}
            },
            "opacity": {
                "condition": {"selection": "lga_highlight", "value": 1},
                "value": 0.2
            },
            "tooltip": [
                {"field": "LGA_SHORT_NM", "type": "nominal", "title": "LGA"},
                {"aggregate": "average","field": "ALLVEHS_AADT", "type": "quantitative", "title": "AADT"}
            ]
            }
        }
        vegaEmbed('#vis2', spec3).catch(console.error);

        // Fourth Visualization
        const spec4 = {
            "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
            "title": "Change in Trip Time From 2012-2019 Depending on Trip Purpose",
            "data": {
                "url": "https://raw.githubusercontent.com/nt-p/FIT3179/main/Data/Victorian_travel_data_main.csv",
                "format": {"type": "csv"}
            },
            "transform": [
                {
                    "filter": "datum.trippurp != 'Unknown Purpose'"
                },
                {
                    "calculate": "datum.trippurp == 'Change Mode' ? 'Change Mode of Transport' : datum.trippurp",
                    "as": "trippurp"  
                }
            ],
            "config": {
                "title": {
                    "font": "Afacad Flux",
                    "fontSize": 18
                },
                "axis": {
                    "labelFont": "Afacad Flux",
                    "titleFont": "Afacad Flux",
                    "labelFontSize": 12,
                    "titleFontSize": 14
                    },
                    "legend": {
                    "labelFont": "Afacad Flux",
                    "titleFont": "Afacad Flux",
                    "labelFontSize": 12,
                    "titleFontSize": 14
                    }
                
            },
            "selection": {
                "tripPurpose": {
                    "type" : "single",
                    "fields": ["trippurp"],
                    "bind": "legend",
                    "empty": "all"
                }
            },
            "width": "container",
            "height": "container",
            "selection": {
                "purp_highlight":{
                    "type": "single",
                    "fields": ["trippurp"],
                    "bind": "legend"
                }
            },
            "mark": "line",
            "encoding": {
                "x": {
                "field": "year",
                "type": "temporal",
                "timeUnit": "year",
                "title": "Year",
                "axis": {"format": "%Y"}
                },
                "y": {
                    "aggregate": "average",
                "field": "triptime",
                "type": "quantitative",
                "title": "Trip Time"
                },
                "color": {
                    "field": "trippurp",
                    "type": "nominal",
                    "title": "Trip Purpose",
                    "scale": {"scheme": "category20c"},
                    "legend": {"title": "Trip Purpose"}
                },
                "opacity": {
                "condition": {"selection": "purp_highlight", "value": 1},
                "value": 0.2
            },
                "tooltip": [
                {"field": "year", "type": "temporal", "title": "Year"},
                {"aggregate": "average","field": "triptime", "type": "quantitative", "title": "Trip Time"},
                {"field": "trippurp", "type": "nominal", "title": "Trip Purpose"}
                ]
            }
        };
        vegaEmbed('#vis3', spec4).catch(console.error);
    </script>

</body>
</html>